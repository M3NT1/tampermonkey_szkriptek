// ==UserScript==
// @name         JIRA Simple Deadline Watcher
// @namespace    http://tampermonkey.net/
// @version      0.4
// @description  Színezi a feladatokat a határidő közelségének függvényében
// @match        https://jira.ulyssys.hu/browse/*
// @grant        none
// ==/UserScript==

(function() {
    'use strict';

    function checkDeadline() {
        const dueDateElement = document.querySelector('#datesmodule .dates dd.date time');
        if (!dueDateElement) return;

        const dueDate = new Date(dueDateElement.getAttribute('datetime'));
        const today = new Date();
        const daysLeft = Math.ceil((dueDate - today) / (1000 * 60 * 60 * 24));

        const datesModule = document.getElementById('datesmodule');
        if (!datesModule) return;

        // Színezés hozzáadása
        if (daysLeft <= 0) {
            datesModule.style.backgroundColor = 'rgba(255, 0, 0, 0.1)';
        } else if (daysLeft <= 3) {
            datesModule.style.backgroundColor = 'rgba(255, 165, 0, 0.1)';
        } else if (daysLeft <= 7) {
            datesModule.style.backgroundColor = 'rgba(255, 255, 0, 0.1)';
        } else {
            datesModule.style.backgroundColor = '';
        }

        // Figyelmeztetés hozzáadása
        let warningText = '';
        if (daysLeft <= 0) {
            warningText = 'Határidő lejárt!';
        } else if (daysLeft <= 7) {
            warningText = `Figyelem! Határidő ${daysLeft} nap múlva!`;
        }

        let warningElement = document.getElementById('deadline-warning');
        if (warningText) {
            if (!warningElement) {
                warningElement = document.createElement('div');
                warningElement.id = 'deadline-warning';
                warningElement.style.cssText = `
                    margin-top: 10px;
                    padding: 5px;
                    background-color: #fffbcc;
                    border: 1px solid #e6db55;
                    border-radius: 3px;
                    font-weight: bold;
                `;
                datesModule.appendChild(warningElement);
            }
            warningElement.textContent = warningText;
        } else if (warningElement) {
            warningElement.remove();
        }
    }

    // Első ellenőrzés az oldal betöltése után
    setTimeout(checkDeadline, 2000);

    // Időszakos ellenőrzés beállítása (5 percenként)
    setInterval(checkDeadline, 300000);
})();
